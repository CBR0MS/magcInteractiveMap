{% extends 'base.html' %} 
{% block head_title %}Interactive Map{% endblock %}
{% block head %}
<script type="text/javascript" src="https://cdn.rawgit.com/anvaka/panzoom/v4.4.0/dist/panzoom.min.js"></script>
<style type="text/css" media="screen">
body, html {
    position: fixed;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
}

</style>
{% endblock %}

{% block content %}

    {% load helpers %}
    {% load static %}

    <!-- Sidebar  -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <h3>Marin Art and Garden Center Interactive Map</h3>
        </div>
        <div class="container" style="padding: 10px;">
        {% for tag in tags %}
            {% if tag.name in selections %}
                    <button type="button" class="btn btn-primary btn-block active" 
                    data-toggle="button" 
                    aria-pressed="true"
                    onclick="window.location.href='{% value_in_url tag.id request.GET.urlencode %}'"
                    style="background-color:{{tag.color}}; border-color:{{tag.color}}; opacity: 0.5; " 
                    >{{ tag.name }}</button>
            {% else %}
                <button type="button" class="btn btn-primary btn-block" 
                    data-toggle="button" 
                    aria-pressed="false"
                    onclick="window.location.href='{% value_in_url tag.id request.GET.urlencode %}'"
                    style="background-color:{{tag.color}}; border-color:{{tag.color}}; " 
                    >{{ tag.name }}</button>
            {% endif %}
        {% endfor %}
        </div>
    </nav>
    <button type="button" id="sidebarCollapse" class="btn btn-info">
        <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true">Menu</span>
    </button>

    <div class='zoomable' >
        <div class="rotated" style="transform: rotate(-61deg);">
            <!-- Map -->
            <img src="{{ map.image.url }}" id="map">
            <!-- Clickable buttons drawn over map-->
            <div id="clickElements">
                {% for point in points %}
                    <button type="button" class="btn click pulse" data-toggle="modal" 
                            data-target=".popup-{{ point.id }}"
                            style="bottom:{{ point.y|add:"-25" }}px; left:{{ point.x|add:"-25" }}px;"
                            title="{{ point.short_name }}">
                            <div class="click-center"
                                 style="bottom:12.5px; left:12.5px;"
                                 id="{{ point.id }}">
                            </div>
                    </button>

                {% endfor %}
            </div>
        </div>
    </div>
    <!-- Popup windows for each point on the map-->
    {% for point in points %}
        <div class="modal fade popup-{{ point.id }}" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <iframe src="details/{{ point.id }}" class="rounded details-frame"></iframe>
                </div>
            </div>
        </div>
    {% endfor %}
    <!--
    <a href="{% value_in_url 'dogs' request.GET.urlencode %}"><button type="button">Dogs</button></a>
<a href="{% value_in_url 'puckles' request.GET.urlencode %}"><button type="button">Puckles</button></a>

Selections: 
{% for tag in selections %}
    <p>{{ tag }}</p>
{% endfor %}
-->
{% endblock %}

{% block scripts%}
<script type="text/javascript">
let area = document.querySelector('.zoomable')
panzoom(area);
        /*panzoom(area).zoomAbs(
                                -1100, // initial x position
                                -1500, // initial y position
                                0.5  // initial zoom 
                                );*/
                                let height = {{ map.image.height | js}};
                                let width = {{ map.image.width | js}};
                                let points = {{ points | js}};
                                let colors = {{ pointColors | js }}
                                </script>
                                <script type="text/javascript" src="{% static "map.js" %}"></script>
                                {% endblock %}
